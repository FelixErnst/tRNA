---
title: "Analyzing tRNA sequences and structures"
author: "Felix G.M. Ernst"
date: "`r Sys.Date()`"
package: tRNA
abstract: >
  Example of importing tRNAdb output as GRanges
output:
  BiocStyle::html_document:
    toc: true
    toc_float: true
    df_print: paged
vignette: >
  %\VignetteIndexEntry{tRNA}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown(css.files = c('custom.css'))
```

# Introduction

The tRNA package allows information of tRNA to be accessed and subset based on 
these features. The package expects a `GRanges` object with certain columns
as input. The following columns are a requirement: `tRNA_length`, `tRNA_type`,
`tRNA_anticodon`, `tRNA_seq`, `tRNA_str`, `tRNA_CCA.end`.

# Loading tRNA information

For working with the tRNA packages, tRNA information can be retrieved in a 
number of ways:

  1. A `GRanges` object can be constructed by hand containing the
required colums (see above)
  2. a tRNAscan result file can be loaded using 
  `import.tRNAscanAsGRanges()` from `tRNAscanImport` package
  3. selected tRNA information can be retrieved using
  `import.tRNAdb()` from `tRNAdbImport` package

For this vignette a predefined `GRanges` object is loaded.

```{r, echo=FALSE}
suppressPackageStartupMessages(
  library(tRNA)
)
data("gr", package = "tRNA", envir = environment())
```

```{r, eval=FALSE}
library(tRNA)
data("gr", package = "tRNA", envir = environment())
```

# tRNA sequences and structures

To retrieve the sequences for individual tRNA structure elements 
`gettRNAstructureGRanges` or `gettRNAstructureSeqs` can be used. Be aware, that
`gettRNAstructureSeqs` is currently a bit experimental. (Please report any 
unexpected results. Thanks!)

```{r}
# just get the coordinates of the anticodonloop
gettRNAstructureGRanges(gr,
                        structure = "anticodonLoop")
gettRNAstructureSeqs(gr,
                     joinFeatures = TRUE,
                     structure = "anticodonLoop")
```

In addition the sequences can be returned already joined to get a fully blank
padded set of sequences.

```{r}
seqs <- gettRNAstructureSeqs(gr[1:10],
                             joinCompletely = TRUE)
seqs
# getting the tRNA structure boundaries
metadata(seqs)[["tRNA_structures"]]
```

# Subsetting tRNA sequences

The structure information can be queried for subsetting using the function
`hasAccpeptorStem()` as an example.

```{r echo=TRUE, results="hide"}
gr[hasAcceptorStem(gr, unpaired = TRUE)]
# mismatches and bulged are subsets of unpaired
gr[hasAcceptorStem(gr, mismatches = TRUE)]
gr[hasAcceptorStem(gr, bulged = TRUE)]
# combination of different structure parameters
gr[hasAcceptorStem(gr, mismatches = TRUE) & 
     hasDloop(gr, length = 8)]
```

To retrieve detailed information on the base pairing `gettRNABasePairing()` or
`getBasePairing()` depending on the input type. The DotBracket annotation is
expected with pairs of `><{}[]()`.

```{r}
head(gettRNABasePairing(gr)[[1]])
head(getBasePairing(gr[1]$tRNA_str)[[1]])
```

# Visualization



# Session info

```{r}
sessionInfo()
```
